<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¿ä¸ŠæŒ‚å· - åŒ»é™¢é—¨è¯Šç®¡ç†ç³»ç»Ÿ</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/common.css">
    <style>
        .doctor-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .doctor-card.selected {
            border: 2px solid #667eea;
            background-color: #f8f9ff;
        }
        .time-slot {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .time-slot:hover {
            background-color: #e9ecef;
        }
        .time-slot.selected {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }
        .time-slot.disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="navbar-container"></div>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title mb-0">ğŸ©º çº¿ä¸ŠæŒ‚å·</h4>
                    </div>
                    <div class="card-body">
                        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="steps">
                                    <div class="step active">
                                        <div class="step-number">1</div>
                                        <div class="step-label">é€‰æ‹©ç§‘å®¤</div>
                                    </div>
                                    <div class="step">
                                        <div class="step-number">2</div>
                                        <div class="step-label">é€‰æ‹©åŒ»ç”Ÿ</div>
                                    </div>
                                    <div class="step">
                                        <div class="step-number">3</div>
                                        <div class="step-label">é€‰æ‹©æ—¶é—´</div>
                                    </div>
                                    <div class="step">
                                        <div class="step-number">4</div>
                                        <div class="step-label">ç¡®è®¤æŒ‚å·</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç§‘å®¤é€‰æ‹© -->
                        <div id="step1" class="step-content">
                            <h5>è¯·é€‰æ‹©å°±è¯Šç§‘å®¤</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card doctor-card" data-dept="å†…ç§‘">
                                        <div class="card-body text-center">
                                            <div class="h3 text-primary">â¤ï¸</div>
                                            <h6>å†…ç§‘</h6>
                                            <small class="text-muted">æ„Ÿå†’ã€å‘çƒ§ã€é«˜è¡€å‹ç­‰</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card doctor-card" data-dept="å¤–ç§‘">
                                        <div class="card-body text-center">
                                            <div class="h3 text-success">ğŸ¦´</div>
                                            <h6>å¤–ç§‘</h6>
                                            <small class="text-muted">åˆ›ä¼¤ã€æ‰‹æœ¯ã€éª¨ç§‘ç­‰</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card doctor-card" data-dept="å„¿ç§‘">
                                        <div class="card-body text-center">
                                            <div class="h3 text-warning">ğŸ‘¶</div>
                                            <h6>å„¿ç§‘</h6>
                                            <small class="text-muted">å„¿ç«¥ç–¾ç—…ã€ç”Ÿé•¿å‘è‚²</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card doctor-card" data-dept="å¦‡äº§ç§‘">
                                        <div class="card-body text-center">
                                            <div class="h3 text-danger">ğŸ¤°</div>
                                            <h6>å¦‡äº§ç§‘</h6>
                                            <small class="text-muted">å¦‡ç§‘ç–¾ç—…ã€å­•äº§æ£€æŸ¥</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card doctor-card" data-dept="çœ¼ç§‘">
                                        <div class="card-body text-center">
                                            <div class="h3 text-info">ğŸ‘ï¸</div>
                                            <h6>çœ¼ç§‘</h6>
                                            <small class="text-muted">è§†åŠ›æ£€æŸ¥ã€çœ¼éƒ¨ç–¾ç—…</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card doctor-card" data-dept="å£è…”ç§‘">
                                        <div class="card-body text-center">
                                            <div class="h3 text-secondary">ğŸ¦·</div>
                                            <h6>å£è…”ç§‘</h6>
                                            <small class="text-muted">ç‰™é½¿æ£€æŸ¥ã€å£è…”æ²»ç–—</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-primary" onclick="nextStep(1)">ä¸‹ä¸€æ­¥</button>
                            </div>
                        </div>

                        <!-- åŒ»ç”Ÿé€‰æ‹© -->
                        <div id="step2" class="step-content d-none">
                            <h5>è¯·é€‰æ‹©åŒ»ç”Ÿ</h5>
                            <div class="row" id="doctorList">
                                <!-- åŒ»ç”Ÿåˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <div class="row mt-3">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary" onclick="prevStep(2)">ä¸Šä¸€æ­¥</button>
                                </div>
                                <div class="col-6 text-end">
                                    <button class="btn btn-primary" onclick="nextStep(2)">ä¸‹ä¸€æ­¥</button>
                                </div>
                            </div>
                        </div>

                        <!-- æ—¶é—´é€‰æ‹© -->
                        <div id="step3" class="step-content d-none">
                            <h5>è¯·é€‰æ‹©å°±è¯Šæ—¶é—´</h5>
                            <div class="mb-3">
                                <label class="form-label">é€‰æ‹©æ—¥æœŸ</label>
                                <input type="date" class="form-control" id="appointmentDate" min="">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">é€‰æ‹©æ—¶é—´æ®µ</label>
                                <div class="row" id="timeSlots">
                                    <!-- æ—¶é—´æ®µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary" onclick="prevStep(3)">ä¸Šä¸€æ­¥</button>
                                </div>
                                <div class="col-6 text-end">
                                    <button class="btn btn-primary" onclick="nextStep(3)">ä¸‹ä¸€æ­¥</button>
                                </div>
                            </div>
                        </div>

                        <!-- ç¡®è®¤æŒ‚å· -->
                        <div id="step4" class="step-content d-none">
                            <h5>ç¡®è®¤æŒ‚å·ä¿¡æ¯</h5>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>ç§‘å®¤ï¼š</strong><span id="confirmDept">-</span></p>
                                            <p><strong>åŒ»ç”Ÿï¼š</strong><span id="confirmDoctor">-</span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>æ—¶é—´ï¼š</strong><span id="confirmTime">-</span></p>
                                            <p><strong>è´¹ç”¨ï¼š</strong><span id="confirmFee">-</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary" onclick="prevStep(4)">ä¸Šä¸€æ­¥</button>
                                </div>
                                <div class="col-6 text-end">
                                    <button class="btn btn-success" onclick="confirmAppointment()">ç¡®è®¤æŒ‚å·</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../utils/helpers.js"></script>
    
    <script>
        // å…¨å±€å˜é‡å­˜å‚¨é€‰æ‹©ä¿¡æ¯
        let appointmentData = {
            department: '',
            doctor: null,
            date: '',
            time: '',
            fee: 0
        };

        // åŒ»ç”Ÿæ•°æ®
        const doctors = {
            'å†…ç§‘': [
                { id: 1, name: 'å¼ åŒ»ç”Ÿ', title: 'ä¸»ä»»åŒ»å¸ˆ', fee: 50, available: true },
                { id: 2, name: 'æåŒ»ç”Ÿ', title: 'å‰¯ä¸»ä»»åŒ»å¸ˆ', fee: 40, available: true }
            ],
            'å¤–ç§‘': [
                { id: 3, name: 'ç‹åŒ»ç”Ÿ', title: 'ä¸»ä»»åŒ»å¸ˆ', fee: 60, available: true },
                { id: 4, name: 'èµµåŒ»ç”Ÿ', title: 'ä¸»æ²»åŒ»å¸ˆ', fee: 35, available: true }
            ],
            'å„¿ç§‘': [
                { id: 5, name: 'åˆ˜åŒ»ç”Ÿ', title: 'å‰¯ä¸»ä»»åŒ»å¸ˆ', fee: 45, available: true }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadNavbar();
            initAppointmentPage();
        });

        function initAppointmentPage() {
            // è®¾ç½®æœ€å°æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').min = today;
            
            // ç»‘å®šç§‘å®¤é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.doctor-card[data-dept]').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.doctor-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    appointmentData.department = this.dataset.dept;
                });
            });

            // ç»‘å®šæ—¥æœŸå˜åŒ–äº‹ä»¶
            document.getElementById('appointmentDate').addEventListener('change', function() {
                generateTimeSlots();
            });
        }

        function nextStep(currentStep) {
            // éªŒè¯å½“å‰æ­¥éª¤
            if (currentStep === 1 && !appointmentData.department) {
                showMessage('è¯·é€‰æ‹©ç§‘å®¤ï¼', 'error');
                return;
            }
            if (currentStep === 2 && !appointmentData.doctor) {
                showMessage('è¯·é€‰æ‹©åŒ»ç”Ÿï¼', 'error');
                return;
            }
            if (currentStep === 3 && (!appointmentData.date || !appointmentData.time)) {
                showMessage('è¯·é€‰æ‹©å°±è¯Šæ—¶é—´ï¼', 'error');
                return;
            }

            // éšè—å½“å‰æ­¥éª¤ï¼Œæ˜¾ç¤ºä¸‹ä¸€æ­¥
            document.getElementById(`step${currentStep}`).classList.add('d-none');
            document.getElementById(`step${currentStep + 1}`).classList.remove('d-none');
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            updateStepIndicator(currentStep + 1);

            // å¦‚æœæ˜¯ç¬¬äºŒæ­¥ï¼Œç”ŸæˆåŒ»ç”Ÿåˆ—è¡¨
            if (currentStep === 1) {
                generateDoctorList();
            }
            // å¦‚æœæ˜¯ç¬¬å››æ­¥ï¼Œæ›´æ–°ç¡®è®¤ä¿¡æ¯
            if (currentStep === 3) {
                updateConfirmation();
            }
        }

        function prevStep(currentStep) {
            document.getElementById(`step${currentStep}`).classList.add('d-none');
            document.getElementById(`step${currentStep - 1}`).classList.remove('d-none');
            updateStepIndicator(currentStep - 1);
        }

        function updateStepIndicator(step) {
            document.querySelectorAll('.step').forEach((stepEl, index) => {
                if (index + 1 <= step) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.remove('active');
                }
            });
        }

        function generateDoctorList() {
            const doctorList = document.getElementById('doctorList');
            const deptDoctors = doctors[appointmentData.department] || [];
            
            doctorList.innerHTML = deptDoctors.map(doctor => `
                <div class="col-md-6 mb-3">
                    <div class="card doctor-card ${!doctor.available ? 'opacity-50' : ''}" 
                         data-doctor-id="${doctor.id}" 
                         onclick="${doctor.available ? `selectDoctor(${doctor.id})` : ''}">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-8">
                                    <h6>${doctor.name}</h6>
                                    <small class="text-muted">${doctor.title}</small>
                                    <div class="mt-2">
                                        <span class="badge bg-primary">æŒ‚å·è´¹: Â¥${doctor.fee}</span>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="h3 text-success">ğŸ©º</div>
                                    ${!doctor.available ? '<small class="text-danger">å·²æ»¡</small>' : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectDoctor(doctorId) {
            const deptDoctors = doctors[appointmentData.department];
            appointmentData.doctor = deptDoctors.find(d => d.id === doctorId);
            appointmentData.fee = appointmentData.doctor.fee;
            
            document.querySelectorAll('.doctor-card[data-doctor-id]').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-doctor-id="${doctorId}"]`).classList.add('selected');
        }

        function generateTimeSlots() {
            const date = document.getElementById('appointmentDate').value;
            appointmentData.date = date;
            
            const timeSlotsContainer = document.getElementById('timeSlots');
            const timeSlots = [
                '08:00-08:30', '08:30-09:00', '09:00-09:30', '09:30-10:00',
                '10:00-10:30', '10:30-11:00', '14:00-14:30', '14:30-15:00',
                '15:00-15:30', '15:30-16:00', '16:00-16:30', '16:30-17:00'
            ];
            
            timeSlotsContainer.innerHTML = timeSlots.map(slot => `
                <div class="col-md-3 mb-2">
                    <div class="time-slot" data-time="${slot}" onclick="selectTimeSlot(this)">
                        ${slot}
                    </div>
                </div>
            `).join('');
        }

        function selectTimeSlot(element) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            element.classList.add('selected');
            appointmentData.time = element.dataset.time;
        }

        function updateConfirmation() {
            document.getElementById('confirmDept').textContent = appointmentData.department;
            document.getElementById('confirmDoctor').textContent = 
                `${appointmentData.doctor.name} (${appointmentData.doctor.title})`;
            document.getElementById('confirmTime').textContent = 
                `${appointmentData.date} ${appointmentData.time}`;
            document.getElementById('confirmFee').textContent = `Â¥${appointmentData.fee}`;
        }

        function confirmAppointment() {
            showMessage('æŒ‚å·æˆåŠŸï¼æ­£åœ¨ç”Ÿæˆè´¦å•...', 'success');
            // æ¨¡æ‹Ÿæ”¯ä»˜æµç¨‹
            setTimeout(() => {
                showMessage('è¯·å‰å¾€è´¢åŠ¡ä¸­å¿ƒæ”¯ä»˜æŒ‚å·è´¹', 'info');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }, 1500);
        }
    </script>

    <style>
        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #dee2e6;
            z-index: 1;
        }
        .step.active:not(:last-child)::after {
            background-color: #667eea;
        }
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #dee2e6;
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
        }
        .step.active .step-number {
            background-color: #667eea;
        }
        .step-label {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .step.active .step-label {
            color: #667eea;
            font-weight: bold;
        }
    </style>
</body>
</html>