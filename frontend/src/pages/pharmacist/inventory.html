<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº“å­˜ç®¡ç† - åŒ»é™¢é—¨è¯Šç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/common.css">
    <style>
        .stock-low {
            background-color: #fff3cd !important;
            border-left: 4px solid #ffc107;
        }
        .stock-critical {
            background-color: #f8d7da !important;
            border-left: 4px solid #dc3545;
        }
        .stock-good {
            border-left: 4px solid #28a745;
        }
        .inventory-card {
            transition: all 0.3s ease;
        }
        .inventory-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .stock-level {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .stock-progress {
            height: 8px;
        }
        .batch-info {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .filter-active {
            background-color: #667eea !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div id="navbar-container"></div>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>ğŸ“¦ åº“å­˜ç®¡ç†</h2>
            <div>
                <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#stockInModal">
                    ğŸ“¥ è¯å“å…¥åº“
                </button>
                <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#adjustStockModal">
                    ğŸ“Š åº“å­˜è°ƒæ•´
                </button>
            </div>
        </div>

        <!-- åº“å­˜æ¦‚è§ˆ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center inventory-card">
                    <div class="card-body">
                        <div class="h4 text-primary">156</div>
                        <div class="text-muted">è¯å“å“ç±»</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center inventory-card">
                    <div class="card-body">
                        <div class="h4 text-success">Â¥286,540</div>
                        <div class="text-muted">åº“å­˜æ€»å€¼</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center inventory-card">
                    <div class="card-body">
                        <div class="h4 text-warning">12</div>
                        <div class="text-muted">åº“å­˜é¢„è­¦</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center inventory-card">
                    <div class="card-body">
                        <div class="h4 text-danger">3</div>
                        <div class="text-muted">ç¼ºè´§è¯å“</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç­›é€‰å’Œæœç´¢ -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" class="form-control" placeholder="æœç´¢è¯å“åç§°..." id="searchMedicine">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="categoryFilter">
                            <option value="">æ‰€æœ‰åˆ†ç±»</option>
                            <option value="æŠ—ç”Ÿç´ ">æŠ—ç”Ÿç´ </option>
                            <option value="æ„Ÿå†’è¯">æ„Ÿå†’è¯</option>
                            <option value="å¿ƒè¡€ç®¡">å¿ƒè¡€ç®¡</option>
                            <option value="ç»´ç”Ÿç´ ">ç»´ç”Ÿç´ </option>
                            <option value="å¤–ç”¨">å¤–ç”¨</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="stockFilter">
                            <option value="">æ‰€æœ‰åº“å­˜çŠ¶æ€</option>
                            <option value="critical">åº“å­˜ç´§å¼ </option>
                            <option value="low">åº“å­˜ä¸è¶³</option>
                            <option value="good">åº“å­˜æ­£å¸¸</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100" onclick="applyFilters()">ç­›é€‰</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº“å­˜åˆ—è¡¨ -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">è¯å“åº“å­˜åˆ—è¡¨</h5>
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-secondary active" onclick="changeView('table')">è¡¨æ ¼è§†å›¾</button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="changeView('card')">å¡ç‰‡è§†å›¾</button>
                </div>
            </div>
            <div class="card-body">
                <!-- è¡¨æ ¼è§†å›¾ -->
                <div id="tableView">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>è¯å“ID</th>
                                    <th>è¯å“åç§°</th>
                                    <th>è§„æ ¼</th>
                                    <th>åˆ†ç±»</th>
                                    <th>å½“å‰åº“å­˜</th>
                                    <th>åº“å­˜çŠ¶æ€</th>
                                    <th>æœ€è¿‘å…¥åº“</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- åŠ¨æ€ç”Ÿæˆåº“å­˜æ•°æ® -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- å¡ç‰‡è§†å›¾ -->
                <div id="cardView" class="d-none">
                    <div class="row" id="inventoryCards">
                        <!-- åŠ¨æ€ç”Ÿæˆåº“å­˜å¡ç‰‡ -->
                    </div>
                </div>

                <!-- åˆ†é¡µ -->
                <nav class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#">ä¸Šä¸€é¡µ</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">ä¸‹ä¸€é¡µ</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- åº“å­˜é¢„è­¦åŒºåŸŸ -->
        <div class="card mt-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">âš ï¸ åº“å­˜é¢„è­¦</h5>
            </div>
            <div class="card-body">
                <div class="row" id="warningItems">
                    <!-- åŠ¨æ€ç”Ÿæˆé¢„è­¦é¡¹ç›® -->
                </div>
            </div>
        </div>
    </div>

    <!-- è¯å“å…¥åº“æ¨¡æ€æ¡† -->
    <div class="modal fade" id="stockInModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ğŸ“¥ è¯å“å…¥åº“</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="stockInForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">é€‰æ‹©è¯å“</label>
                                    <select class="form-select" id="stockInMedicine" required>
                                        <option value="">è¯·é€‰æ‹©è¯å“</option>
                                        <!-- åŠ¨æ€å¡«å……è¯å“é€‰é¡¹ -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">å…¥åº“æ•°é‡</label>
                                    <input type="number" class="form-control" id="stockInQuantity" min="1" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ä¾›åº”å•†</label>
                                    <input type="text" class="form-control" id="stockInSupplier" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">é‡‡è´­å•ä»·</label>
                                    <input type="number" class="form-control" id="stockInPrice" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">æ‰¹å·</label>
                                    <input type="text" class="form-control" id="stockInBatch" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ç”Ÿäº§æ—¥æœŸ</label>
                                    <input type="date" class="form-control" id="stockInProdDate" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æœ‰æ•ˆæœŸè‡³</label>
                            <input type="date" class="form-control" id="stockInExpiryDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">å¤‡æ³¨</label>
                            <textarea class="form-control" id="stockInNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="processStockIn()">ç¡®è®¤å…¥åº“</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº“å­˜è°ƒæ•´æ¨¡æ€æ¡† -->
    <div class="modal fade" id="adjustStockModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ğŸ“Š åº“å­˜è°ƒæ•´</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="adjustStockForm">
                        <div class="mb-3">
                            <label class="form-label">é€‰æ‹©è¯å“</label>
                            <select class="form-select" id="adjustMedicine" required>
                                <option value="">è¯·é€‰æ‹©è¯å“</option>
                                <!-- åŠ¨æ€å¡«å……è¯å“é€‰é¡¹ -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">è°ƒæ•´ç±»å‹</label>
                            <select class="form-select" id="adjustType" required>
                                <option value="increase">å¢åŠ åº“å­˜</option>
                                <option value="decrease">å‡å°‘åº“å­˜</option>
                                <option value="set">è®¾ç½®åº“å­˜</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">è°ƒæ•´æ•°é‡</label>
                            <input type="number" class="form-control" id="adjustQuantity" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">è°ƒæ•´åŸå› </label>
                            <select class="form-select" id="adjustReason" required>
                                <option value="">è¯·é€‰æ‹©åŸå› </option>
                                <option value="ç›˜ç‚¹å·®å¼‚">ç›˜ç‚¹å·®å¼‚</option>
                                <option value="æŠ¥æŸ">æŠ¥æŸ</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">å¤‡æ³¨è¯´æ˜</label>
                            <textarea class="form-control" id="adjustNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="processStockAdjust()">ç¡®è®¤è°ƒæ•´</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº“å­˜è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal fade" id="stockDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ğŸ“‹ åº“å­˜è¯¦æƒ… - <span id="detailMedicineName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <strong>å½“å‰åº“å­˜:</strong> <span id="detailCurrentStock" class="stock-level"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>åº“å­˜çŠ¶æ€:</strong> <span id="detailStockStatus"></span>
                        </div>
                    </div>
                    
                    <h6>åº“å­˜æµæ°´</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>æ—¶é—´</th>
                                    <th>ç±»å‹</th>
                                    <th>æ•°é‡</th>
                                    <th>åŸå› </th>
                                    <th>æ“ä½œäºº</th>
                                </tr>
                            </thead>
                            <tbody id="stockHistory">
                                <!-- åŠ¨æ€ç”Ÿæˆåº“å­˜æµæ°´ -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../utils/helpers.js"></script>
    
    <script>
        // åº“å­˜æ•°æ®
        const inventoryData = [
            { id: 1, name: 'é˜¿è«è¥¿æ—èƒ¶å›Š', specification: '0.25g*24ç²’', category: 'æŠ—ç”Ÿç´ ', currentStock: 15, minStock: 20, maxStock: 200, price: 25.00, supplier: 'ååŒ—åˆ¶è¯', lastStockIn: '2024-01-10' },
            { id: 2, name: 'æ„Ÿå†’çµé¢—ç²’', specification: '10g*9è¢‹', category: 'æ„Ÿå†’è¯', currentStock: 8, minStock: 15, maxStock: 100, price: 18.50, supplier: 'ç™½äº‘å±±', lastStockIn: '2024-01-12' },
            { id: 3, name: 'é™å‹ç‰‡', specification: '30ç‰‡', category: 'å¿ƒè¡€ç®¡', currentStock: 45, minStock: 20, maxStock: 150, price: 32.00, supplier: 'åä¸œåˆ¶è¯', lastStockIn: '2024-01-08' },
            { id: 4, name: 'ç»´ç”Ÿç´ Cç‰‡', specification: '100mg*60ç‰‡', category: 'ç»´ç”Ÿç´ ', currentStock: 120, minStock: 50, maxStock: 300, price: 12.00, supplier: 'åº·æ©è´', lastStockIn: '2024-01-05' },
            { id: 5, name: 'æ­¢ç—›è´´è†', specification: '5è´´/ç›’', category: 'å¤–ç”¨', currentStock: 25, minStock: 30, maxStock: 100, price: 25.00, supplier: 'äº‘å—ç™½è¯', lastStockIn: '2024-01-09' },
            { id: 6, name: 'çœ¼è¯æ°´', specification: '10ml', category: 'çœ¼ç§‘', currentStock: 0, minStock: 10, maxStock: 80, price: 15.00, supplier: 'çè§†æ˜', lastStockIn: '2023-12-20' },
            { id: 7, name: 'è‚ èƒƒè¯', specification: '20ç‰‡', category: 'æ¶ˆåŒ–ç³»ç»Ÿ', currentStock: 35, minStock: 25, maxStock: 120, price: 28.00, supplier: 'æ±Ÿä¸­åˆ¶è¯', lastStockIn: '2024-01-07' },
            { id: 8, name: 'æ¶ˆç‚è¯', specification: '0.1g*24ç‰‡', category: 'æŠ—ç”Ÿç´ ', currentStock: 60, minStock: 30, maxStock: 150, price: 18.00, supplier: 'çŸ³è¯é›†å›¢', lastStockIn: '2024-01-11' }
        ];

        // åº“å­˜æµæ°´æ•°æ®
        const stockHistory = {
            1: [
                { date: '2024-01-15 14:30', type: 'å‡ºåº“', quantity: -5, reason: 'å¤„æ–¹æ¶ˆè€—', operator: 'æè¯å‰‚å¸ˆ' },
                { date: '2024-01-10 09:15', type: 'å…¥åº“', quantity: 50, reason: 'é‡‡è´­å…¥åº“', operator: 'å¼ ç®¡ç†å‘˜' },
                { date: '2024-01-08 16:20', type: 'å‡ºåº“', quantity: -3, reason: 'å¤„æ–¹æ¶ˆè€—', operator: 'æè¯å‰‚å¸ˆ' }
            ],
            2: [
                { date: '2024-01-14 11:30', type: 'å‡ºåº“', quantity: -2, reason: 'å¤„æ–¹æ¶ˆè€—', operator: 'ç‹è¯å‰‚å¸ˆ' },
                { date: '2024-01-12 10:00', type: 'å…¥åº“', quantity: 30, reason: 'é‡‡è´­å…¥åº“', operator: 'å¼ ç®¡ç†å‘˜' }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadNavbar();
            initializeInventoryPage();
        });

        function initializeInventoryPage() {
            renderInventoryTable();
            renderInventoryCards();
            renderWarningItems();
            populateMedicineSelects();
            setupEventListeners();
        }

        function setupEventListeners() {
            // æœç´¢åŠŸèƒ½
            document.getElementById('searchMedicine').addEventListener('input', function() {
                applyFilters();
            });

            // ç­›é€‰åŠŸèƒ½
            document.getElementById('categoryFilter').addEventListener('change', function() {
                applyFilters();
            });

            document.getElementById('stockFilter').addEventListener('change', function() {
                applyFilters();
            });
        }

        function renderInventoryTable() {
            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = inventoryData.map(item => {
                const stockStatus = getStockStatus(item);
                const statusClass = getStatusClass(stockStatus);
                const progress = (item.currentStock / item.maxStock) * 100;
                
                return `
                    <tr class="${statusClass}" data-medicine-id="${item.id}">
                        <td>${item.id}</td>
                        <td>
                            <strong>${item.name}</strong>
                            <div class="batch-info">${item.specification}</div>
                        </td>
                        <td>${item.specification}</td>
                        <td><span class="badge bg-secondary">${item.category}</span></td>
                        <td>
                            <div class="stock-level ${getStockLevelClass(item)}">${item.currentStock}</div>
                            <div class="progress stock-progress mt-1">
                                <div class="progress-bar ${getProgressBarClass(item)}" 
                                     style="width: ${progress}%"></div>
                            </div>
                            <small class="text-muted">å®‰å…¨åº“å­˜: ${item.minStock}</small>
                        </td>
                        <td>
                            <span class="badge ${getStatusBadgeClass(stockStatus)}">
                                ${getStatusText(stockStatus)}
                            </span>
                        </td>
                        <td>${item.lastStockIn}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewStockDetail(${item.id})">
                                è¯¦æƒ…
                            </button>
                            <button class="btn btn-sm btn-outline-warning" onclick="quickStockIn(${item.id})">
                                å¿«é€Ÿå…¥åº“
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderInventoryCards() {
            const container = document.getElementById('inventoryCards');
            container.innerHTML = inventoryData.map(item => {
                const stockStatus = getStockStatus(item);
                const statusClass = getStatusClass(stockStatus);
                const progress = (item.currentStock / item.maxStock) * 100;
                
                return `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card inventory-card ${statusClass}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title">${item.name}</h6>
                                    <span class="badge ${getStatusBadgeClass(stockStatus)}">
                                        ${getStatusText(stockStatus)}
                                    </span>
                                </div>
                                <p class="card-text text-muted small">${item.specification}</p>
                                <div class="mb-2">
                                    <span class="badge bg-light text-dark">${item.category}</span>
                                </div>
                                <div class="stock-level ${getStockLevelClass(item)} mb-2">
                                    åº“å­˜: ${item.currentStock}
                                </div>
                                <div class="progress stock-progress mb-2">
                                    <div class="progress-bar ${getProgressBarClass(item)}" 
                                         style="width: ${progress}%"></div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted">å®‰å…¨: ${item.minStock}</small>
                                    <small class="text-muted">æœ€å¤§: ${item.maxStock}</small>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-sm btn-outline-primary w-100 mb-1" 
                                            onclick="viewStockDetail(${item.id})">
                                        åº“å­˜è¯¦æƒ…
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning w-100" 
                                            onclick="quickStockIn(${item.id})">
                                        å¿«é€Ÿå…¥åº“
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderWarningItems() {
            const container = document.getElementById('warningItems');
            const warningItems = inventoryData.filter(item => 
                getStockStatus(item) === 'critical' || getStockStatus(item) === 'low'
            );
            
            if (warningItems.length === 0) {
                container.innerHTML = '<div class="col-12 text-center text-muted">æš‚æ— åº“å­˜é¢„è­¦</div>';
                return;
            }
            
            container.innerHTML = warningItems.map(item => {
                const stockStatus = getStockStatus(item);
                return `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card ${stockStatus === 'critical' ? 'stock-critical' : 'stock-low'}">
                            <div class="card-body">
                                <h6 class="card-title">${item.name}</h6>
                                <p class="card-text mb-1">å½“å‰åº“å­˜: <strong>${item.currentStock}</strong></p>
                                <p class="card-text mb-1">å®‰å…¨åº“å­˜: ${item.minStock}</p>
                                <p class="card-text mb-2">ç¼ºè´§æ•°é‡: ${item.minStock - item.currentStock}</p>
                                <button class="btn btn-sm btn-warning" onclick="quickStockIn(${item.id})">
                                    ç«‹å³è¡¥è´§
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function populateMedicineSelects() {
            const stockInSelect = document.getElementById('stockInMedicine');
            const adjustSelect = document.getElementById('adjustMedicine');
            
            stockInSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¯å“</option>' + 
                inventoryData.map(item => 
                    `<option value="${item.id}">${item.name} - ${item.specification}</option>`
                ).join('');
            
            adjustSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¯å“</option>' + 
                inventoryData.map(item => 
                    `<option value="${item.id}">${item.name} - ${item.specification}</option>`
                ).join('');
        }

        function getStockStatus(item) {
            if (item.currentStock === 0) return 'critical';
            if (item.currentStock < item.minStock) return 'low';
            return 'good';
        }

        function getStatusClass(status) {
            switch(status) {
                case 'critical': return 'stock-critical';
                case 'low': return 'stock-low';
                default: return 'stock-good';
            }
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'critical': return 'bg-danger';
                case 'low': return 'bg-warning';
                default: return 'bg-success';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'critical': return 'åº“å­˜ç´§å¼ ';
                case 'low': return 'åº“å­˜ä¸è¶³';
                default: return 'åº“å­˜æ­£å¸¸';
            }
        }

        function getStockLevelClass(item) {
            if (item.currentStock === 0) return 'text-danger';
            if (item.currentStock < item.minStock) return 'text-warning';
            return 'text-success';
        }

        function getProgressBarClass(item) {
            if (item.currentStock === 0) return 'bg-danger';
            if (item.currentStock < item.minStock) return 'bg-warning';
            return 'bg-success';
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchMedicine').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;
            
            // è¡¨æ ¼è§†å›¾ç­›é€‰
            document.querySelectorAll('#inventoryTable tr').forEach(row => {
                const medicineId = row.dataset.medicineId;
                const item = inventoryData.find(i => i.id == medicineId);
                if (!item) return;
                
                const matchesSearch = item.name.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const matchesStock = !stockFilter || getStockStatus(item) === stockFilter;
                
                row.style.display = (matchesSearch && matchesCategory && matchesStock) ? '' : 'none';
            });
            
            // å¡ç‰‡è§†å›¾ç­›é€‰
            document.querySelectorAll('#inventoryCards .col-md-6').forEach(card => {
                card.style.display = ''; // é‡ç½®æ˜¾ç¤º
            });
        }

        function changeView(viewType) {
            const tableView = document.getElementById('tableView');
            const cardView = document.getElementById('cardView');
            const tableBtn = document.querySelector('button[onclick="changeView(\'table\')"]');
            const cardBtn = document.querySelector('button[onclick="changeView(\'card\')"]');
            
            if (viewType === 'table') {
                tableView.classList.remove('d-none');
                cardView.classList.add('d-none');
                tableBtn.classList.add('filter-active');
                cardBtn.classList.remove('filter-active');
            } else {
                tableView.classList.add('d-none');
                cardView.classList.remove('d-none');
                tableBtn.classList.remove('filter-active');
                cardBtn.classList.add('filter-active');
            }
        }

        function viewStockDetail(medicineId) {
            const item = inventoryData.find(i => i.id === medicineId);
            if (!item) return;
            
            document.getElementById('detailMedicineName').textContent = item.name;
            document.getElementById('detailCurrentStock').textContent = item.currentStock;
            document.getElementById('detailStockStatus').innerHTML = 
                `<span class="badge ${getStatusBadgeClass(getStockStatus(item))}">
                    ${getStatusText(getStockStatus(item))}
                </span>`;
            
            // å¡«å……åº“å­˜æµæ°´
            const history = stockHistory[medicineId] || [];
            const historyTbody = document.getElementById('stockHistory');
            historyTbody.innerHTML = history.map(record => `
                <tr>
                    <td>${record.date}</td>
                    <td>
                        <span class="badge ${record.quantity > 0 ? 'bg-success' : 'bg-danger'}">
                            ${record.type}
                        </span>
                    </td>
                    <td class="${record.quantity > 0 ? 'text-success' : 'text-danger'}">
                        ${record.quantity > 0 ? '+' : ''}${record.quantity}
                    </td>
                    <td>${record.reason}</td>
                    <td>${record.operator}</td>
                </tr>
            `).join('');
            
            const modal = new bootstrap.Modal(document.getElementById('stockDetailModal'));
            modal.show();
        }

        function quickStockIn(medicineId) {
            const item = inventoryData.find(i => i.id === medicineId);
            if (!item) return;
            
            document.getElementById('stockInMedicine').value = medicineId;
            document.getElementById('stockInQuantity').value = item.minStock * 2;
            document.getElementById('stockInSupplier').value = item.supplier;
            document.getElementById('stockInPrice').value = item.price;
            
            const modal = new bootstrap.Modal(document.getElementById('stockInModal'));
            modal.show();
        }

        function processStockIn() {
            const form = document.getElementById('stockInForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const medicineId = parseInt(document.getElementById('stockInMedicine').value);
            const quantity = parseInt(document.getElementById('stockInQuantity').value);
            
            // æ›´æ–°åº“å­˜æ•°æ®
            const item = inventoryData.find(i => i.id === medicineId);
            if (item) {
                item.currentStock += quantity;
                item.lastStockIn = new Date().toISOString().split('T')[0];
                
                // é‡æ–°æ¸²æŸ“ç•Œé¢
                renderInventoryTable();
                renderInventoryCards();
                renderWarningItems();
                
                showMessage(`æˆåŠŸå…¥åº“ ${quantity} ä»¶è¯å“`, 'success');
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('stockInModal'));
                modal.hide();
                form.reset();
            }
        }

        function processStockAdjust() {
            const form = document.getElementById('adjustStockForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const medicineId = parseInt(document.getElementById('adjustMedicine').value);
            const adjustType = document.getElementById('adjustType').value;
            const quantity = parseInt(document.getElementById('adjustQuantity').value);
            
            const item = inventoryData.find(i => i.id === medicineId);
            if (item) {
                switch(adjustType) {
                    case 'increase':
                        item.currentStock += quantity;
                        break;
                    case 'decrease':
                        item.currentStock = Math.max(0, item.currentStock - quantity);
                        break;
                    case 'set':
                        item.currentStock = quantity;
                        break;
                }
                
                // é‡æ–°æ¸²æŸ“ç•Œé¢
                renderInventoryTable();
                renderInventoryCards();
                renderWarningItems();
                
                showMessage(`åº“å­˜è°ƒæ•´æˆåŠŸ`, 'success');
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('adjustStockModal'));
                modal.hide();
                form.reset();
            }
        }
    </script>
</body>
</html>