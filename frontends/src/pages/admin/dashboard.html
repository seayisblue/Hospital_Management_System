<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜é¦–é¡µ - åŒ»é™¢é—¨è¯Šç®¡ç†ç³»ç»Ÿ</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/common.css">
    <style>
        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
        }
        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .bg-patient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bg-doctor { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .bg-appointment { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .bg-revenue { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    </style>
</head>
<body>
    <div id="navbar-container"></div>

    <div class="container mt-4">
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card bg-patient">
                    <div class="icon">ğŸ‘¥</div>
                    <div class="number" id="stat-patient">-</div> <div class="label">æ³¨å†Œæ‚£è€…</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-doctor">
                    <div class="icon">ğŸ©º</div>
                    <div class="number" id="stat-doctor">-</div> <div class="label">åœ¨èŒåŒ»ç”Ÿ</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-appointment">
                    <div class="icon">ğŸ“…</div>
                    <div class="number" id="stat-appointment">-</div> <div class="label">ä»Šæ—¥é¢„çº¦</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-revenue">
                    <div class="icon">ğŸ’°</div>
                    <div class="number" id="stat-revenue">-</div> <div class="label">ä»Šæ—¥æ”¶å…¥</div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†åŠŸèƒ½ -->
        <div class="row">
            <!-- èŒå·¥ç®¡ç† -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="h1 text-primary">ğŸ‘¨â€ğŸ’¼</div>
                        <h5 class="card-title">èŒå·¥ç®¡ç†</h5>
                        <p class="card-text">ç®¡ç†ç³»ç»Ÿç”¨æˆ·ï¼ˆåŒ»ç”Ÿã€è¯å‰‚å¸ˆã€ç®¡ç†å‘˜ï¼‰çš„å¢åˆ æ”¹æŸ¥</p>
                        <a href="staff-management.html" class="btn btn-primary">ç®¡ç†èŒå·¥</a>
                    </div>
                </div>
            </div>

            <!-- ç§‘å®¤ç®¡ç† -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="h1 text-success">ğŸ¢</div>
                        <h5 class="card-title">ç§‘å®¤ç®¡ç†</h5>
                        <p class="card-text">ç®¡ç†åŒ»é™¢ç§‘å®¤ä¿¡æ¯ï¼Œè®¾ç½®ç§‘å®¤æè¿°å’Œè´Ÿè´£äºº</p>
                        <a href="department-management.html" class="btn btn-primary">ç®¡ç†ç§‘å®¤</a>
                    </div>
                </div>
            </div>

            <!-- è¯å“ç®¡ç† -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="h1 text-warning">ğŸ’Š</div>
                        <h5 class="card-title">è¯å“ç®¡ç†</h5>
                        <p class="card-text">ç®¡ç†è¯æˆ¿è¯å“ä¿¡æ¯ï¼Œåº“å­˜ç®¡ç†å’Œä»·æ ¼è®¾ç½®</p>
                        <a href="medicine-management.html" class="btn btn-primary">ç®¡ç†è¯å“</a>
                    </div>
                </div>
            </div>

            <!-- ç°åœºæŒ‚å· -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="h1 text-info">ğŸ«</div>
                        <h5 class="card-title">ç°åœºæŒ‚å·</h5>
                        <p class="card-text">ä¸ºæœªæ³¨å†Œæ‚£è€…è¿›è¡Œå»ºæ¡£å’ŒæŒ‚å·æ“ä½œ</p>
                        <a href="on-site-registration.html" class="btn btn-primary">å¼€å§‹æŒ‚å·</a>
                    </div>
                </div>
            </div>

            <!-- è´¢åŠ¡ä¸­å¿ƒ -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="h1 text-danger">ğŸ’°</div>
                        <h5 class="card-title">è´¢åŠ¡ä¸­å¿ƒ</h5>
                        <p class="card-text">ç®¡ç†æ”¶è´¹è´¦å•ï¼Œç¡®è®¤æ”¶æ¬¾å’Œè´¢åŠ¡ç»Ÿè®¡</p>
                        <a href="finance-center.html" class="btn btn-primary">è´¢åŠ¡ç®¡ç†</a>
                    </div>
                </div>
            </div>

            <!-- è¯å“å…¥åº“ -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="h1 text-secondary">ğŸ“¦</div>
                        <h5 class="card-title">è¯å“å…¥åº“</h5>
                        <p class="card-text">è¯å“é‡‡è´­å…¥åº“ç®¡ç†å’Œåº“å­˜æµæ°´è®°å½•</p>
                        <a href="medicine-stock.html" class="btn btn-primary">å…¥åº“ç®¡ç†</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»Šæ—¥å¾…åŠ -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">ğŸ“‹ ä»Šæ—¥å¾…åŠäº‹é¡¹</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-warning me-2">è´¢åŠ¡</span>
                                    å½“å‰æœ‰æœªæ”¯ä»˜çš„è´¦å•ï¼Œè¯·åŠæ—¶ç¡®è®¤æ”¶æ¬¾
                                </div>
                                <a href="finance-center.html" class="btn btn-sm btn-primary">å»æ”¶æ¬¾</a>
                            </div>

                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-success me-2">åº“å­˜</span>
                                    æŸ¥çœ‹è¯å“åº“å­˜æ˜¯å¦å……è¶³
                                </div>
                                <a href="medicine-stock.html" class="btn btn-sm btn-primary">æŸ¥åº“å­˜</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../utils/helpers.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadNavbar();
            fetchDashboardStats(); // åŠ è½½ç»Ÿè®¡æ•°æ®
        });

        // â˜…â˜…â˜… è·å–é¦–é¡µç»Ÿè®¡æ•°æ® â˜…â˜…â˜…
        async function fetchDashboardStats() {
            const token = localStorage.getItem('token');
            if (!token) return window.location.href = 'login.html';

            try {
                // è°ƒç”¨æˆ‘ä»¬åˆšå†™çš„æ–°æ¥å£
                const response = await fetch('http://localhost:8081/admin/dashboard/stats', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token
                    }
                });

                const result = await response.json();

                if (result.code === 200) {
                    const stats = result.data;

                    // å¡«å……æ•°æ® (å¸¦ç®€å•çš„åŠ¨ç”»æ•ˆæœæˆ–ç›´æ¥æ˜¾ç¤º)
                    document.getElementById('stat-patient').textContent = stats.patientCount;
                    document.getElementById('stat-doctor').textContent = stats.doctorCount;
                    document.getElementById('stat-appointment').textContent = stats.todayAppointment;
                    document.getElementById('stat-revenue').textContent = 'Â¥' + stats.todayRevenue;
                } else {
                    if (result.code === 401) window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('è·å–ç»Ÿè®¡å¤±è´¥:', error);
                // ä¿æŒæ˜¾ç¤º "-" æˆ–æ˜¾ç¤º "0"
            }
        }
    </script>
</body>
</html>