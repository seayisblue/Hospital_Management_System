<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>药房工作站 - 医院门诊管理系统</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/common.css">
</head>
<body>
    <div id="navbar-container"></div>

    <div class="container mt-4">
        <!-- 药剂师信息横幅 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4>💊 李药剂师，欢迎回来！</h4>
                                <p class="mb-0">药房主管 | 今日已处理处方: <strong>15</strong> 张</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="h5">📅 2024年1月15日</div>
                                <div>星期一 10:00 AM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 待处理处方 -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">📋 待处理处方</h5>
                        <span class="badge bg-warning">5张待发药</span>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>处方号</th>
                                        <th>患者</th>
                                        <th>开具医生</th>
                                        <th>开具时间</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>RX20240115001</td>
                                        <td>张三</td>
                                        <td>张医生</td>
                                        <td>08:45</td>
                                        <td><span class="badge bg-warning">待发药</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="viewPrescription('RX20240115001')">查看</button>
                                            <button class="btn btn-sm btn-success" onclick="dispenseMedicine('RX20240115001')">发药</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>RX20240115002</td>
                                        <td>李四</td>
                                        <td>王医生</td>
                                        <td>09:15</td>
                                        <td><span class="badge bg-warning">待发药</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="viewPrescription('RX20240115002')">查看</button>
                                            <button class="btn btn-sm btn-success" onclick="dispenseMedicine('RX20240115002')">发药</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>RX20240115003</td>
                                        <td>王五</td>
                                        <td>张医生</td>
                                        <td>09:30</td>
                                        <td><span class="badge bg-warning">待发药</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="viewPrescription('RX20240115003')">查看</button>
                                            <button class="btn btn-sm btn-success" onclick="dispenseMedicine('RX20240115003')">发药</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 今日已完成处方 -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">✅ 今日已完成处方</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>处方号</th>
                                        <th>患者</th>
                                        <th>发药时间</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>RX20240114001</td>
                                        <td>赵六</td>
                                        <td>08:10</td>
                                        <td><span class="badge bg-success">已发药</span></td>
                                    </tr>
                                    <tr>
                                        <td>RX20240114002</td>
                                        <td>钱七</td>
                                        <td>08:35</td>
                                        <td><span class="badge bg-success">已发药</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 快捷功能和库存预警 -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="card-title mb-0">⚠️ 库存预警</h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                阿莫西林胶囊
                                <span class="badge bg-danger">库存不足</span>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                感冒灵颗粒
                                <span class="badge bg-warning">库存紧张</span>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                降压片
                                <span class="badge bg-success">库存正常</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body text-center">
                        <div class="h1 text-primary">📦</div>
                        <h5>库存管理</h5>
                        <p class="card-text">药品入库和库存调整</p>
                        <button class="btn btn-outline-primary w-100" onclick="manageInventory()">管理库存</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body text-center">
                        <div class="h1 text-info">📊</div>
                        <h5>今日统计</h5>
                        <div class="row text-center mt-3">
                            <div class="col-6">
                                <div class="h5 text-primary">15</div>
                                <small>处理处方</small>
                            </div>
                            <div class="col-6">
                                <div class="h5 text-success">128</div>
                                <small>发放药品</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 处方详情模态框 -->
    <div class="modal fade" id="prescriptionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">📄 处方详情 - <span id="modalPrescriptionId"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>患者:</strong> 张三
                        </div>
                        <div class="col-md-6">
                            <strong>开具医生:</strong> 张医生
                        </div>
                    </div>
                    
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>药品名称</th>
                                <th>规格</th>
                                <th>数量</th>
                                <th>用法用量</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>阿莫西林胶囊</td>
                                <td>0.25g*24粒</td>
                                <td>2盒</td>
                                <td>0.5g，一日三次</td>
                            </tr>
                            <tr>
                                <td>感冒灵颗粒</td>
                                <td>10g*9袋</td>
                                <td>1盒</td>
                                <td>1袋，一日三次</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-success" onclick="dispenseFromModal()">确认发药</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../utils/helpers.js"></script>
    
    <script>
        let currentPrescriptionId = '';

        document.addEventListener('DOMContentLoaded', function() {
            loadNavbar();
        });

        function viewPrescription(prescriptionId) {
            currentPrescriptionId = prescriptionId;
            document.getElementById('modalPrescriptionId').textContent = prescriptionId;
            const modal = new bootstrap.Modal(document.getElementById('prescriptionModal'));
            modal.show();
        }

        function dispenseMedicine(prescriptionId) {
            if (confirm(`确定要发放处方 ${prescriptionId} 的药品吗？`)) {
                showMessage(`处方 ${prescriptionId} 发药成功！`, 'success');
                // 这里可以添加更新处方状态的逻辑
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        }

        function dispenseFromModal() {
            dispenseMedicine(currentPrescriptionId);
            const modal = bootstrap.Modal.getInstance(document.getElementById('prescriptionModal'));
            modal.hide();
        }

        function manageInventory() {
            showMessage('跳转到库存管理页面...', 'info');
            setTimeout(() => {
                window.location.href = 'inventory.html';
            }, 1000);
        }
    </script>
</body>
</html>